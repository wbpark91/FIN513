%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Structured General Purpose Assignment
% LaTeX Template
%
% This template has been downloaded from:
% http://www.latextemplates.com
%
% Original author:
% Ted Pavlic (http://www.tedpavlic.com)
%
% Note:
% The \lipsum[#] commands throughout this template generate dummy text
% to fill the template out. These commands should all be removed when 
% writing assignment content.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
%	PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

\documentclass{article}

\usepackage{fancyhdr} % Required for custom headers
\usepackage{lastpage} % Required to determine the last page for the footer
\usepackage{extramarks} % Required for headers and footers
\usepackage{graphicx} % Required to insert images
\usepackage{lipsum} % Used for inserting dummy 'Lorem ipsum' text into the template
\usepackage{enumerate}
\usepackage{booktabs}
\usepackage{amsmath}
\usepackage{subcaption}
\usepackage{tikz}
\usetikzlibrary{matrix}
\usepackage{algorithm2e}

\RestyleAlgo{boxruled}
\LinesNumbered

% Margins
\topmargin=-0.45in
\evensidemargin=0in
\oddsidemargin=0in
\textwidth=6.5in
\textheight=9.0in
\headsep=0.25in 

\linespread{1.5} % Line spacing

% Set up the header and footer
\pagestyle{fancy}
\lhead{\hmwkAuthorName} % Top left header
\chead{\hmwkClass\ (\hmwkTitle)} % Top center header
%%\rhead{\firstxmark} 
\rhead{} % Top right header
\lfoot{\lastxmark} % Bottom left footer
\cfoot{} % Bottom center footer
\rfoot{Page\ \thepage\ of\ \pageref{LastPage}} % Bottom right footer
\renewcommand\headrulewidth{0.4pt} % Size of the header rule
\renewcommand\footrulewidth{0.4pt} % Size of the footer rule

\setlength\parindent{0pt} % Removes all indentation from paragraphs

%----------------------------------------------------------------------------------------
%	DOCUMENT STRUCTURE COMMANDS
%	Skip this unless you know what you're doing
%----------------------------------------------------------------------------------------

% Header and footer for when a page split occurs within a problem environment
\newcommand{\enterProblemHeader}[1]{
\nobreak\extramarks{#1}{#1 continued on next page\ldots}\nobreak
\nobreak\extramarks{#1 (continued)}{#1 continued on next page\ldots}\nobreak
}

% Header and footer for when a page split occurs between problem environments
\newcommand{\exitProblemHeader}[1]{
\nobreak\extramarks{#1 (continued)}{#1 continued on next page\ldots}\nobreak
\nobreak\extramarks{#1}{}\nobreak
}

\setcounter{secnumdepth}{0} % Removes default section numbers
\newcounter{homeworkProblemCounter} % Creates a counter to keep track of the number of problems

\newcommand{\homeworkProblemName}{}
\newenvironment{homeworkProblem}[1][Problem \arabic{homeworkProblemCounter}]{ % Makes a new environment called homeworkProblem which takes 1 argument (custom name) but the default is "Problem #"
\stepcounter{homeworkProblemCounter} % Increase counter for number of problems
\renewcommand{\homeworkProblemName}{#1} % Assign \homeworkProblemName the name of the problem
\section{\homeworkProblemName} % Make a section in the document with the custom problem count
\enterProblemHeader{\homeworkProblemName} % Header and footer within the environment
}{
\exitProblemHeader{\homeworkProblemName} % Header and footer after the environment
}

\newcommand{\problemAnswer}[1]{ % Defines the problem answer command with the content as the only argument
\noindent\framebox[\columnwidth][c]{\begin{minipage}{0.98\columnwidth}#1\end{minipage}} % Makes the box around the problem answer and puts the content inside
}

\newcommand{\homeworkSectionName}{}
\newenvironment{homeworkSection}[1]{ % New environment for sections within homework problems, takes 1 argument - the name of the section
\renewcommand{\homeworkSectionName}{#1} % Assign \homeworkSectionName to the name of the section from the environment argument
\subsection{\homeworkSectionName} % Make a subsection with the custom name of the subsection
\enterProblemHeader{\homeworkProblemName\ [\homeworkSectionName]} % Header and footer within the environment
}{
\enterProblemHeader{\homeworkProblemName} % Header and footer after the environment
}

%----------------------------------------------------------------------------------------
%	NAME AND CLASS SECTION
%----------------------------------------------------------------------------------------

\newcommand{\hmwkTitle}{Homework\ \#5} % Assignment title
\newcommand{\hmwkDueDate}{Tuesday,\ March\ 6,\ 2018} % Due date
\newcommand{\hmwkClass}{FIN\ 513} % Course/class
\newcommand{\hmwkClassTime}{9:30am} % Class/lecture time
\newcommand{\hmwkAuthorName}{Wanbae Park} % Your name

%----------------------------------------------------------------------------------------
%	PARTIAL DERIVATIVES
%----------------------------------------------------------------------------------------
\newcommand{\pdv}[3][]{
	\frac{\partial^{#1}{#2}}{\partial{{#3}^{#1}}}
}

%----------------------------------------------------------------------------------------
%	EXPECTATION AND VARIANCE OPERATOR
%----------------------------------------------------------------------------------------
 \newcommand{\E}{\mathrm{E}} 
 \newcommand{\Var}{\mathrm{Var}}
 \newcommand{\Cov}{\mathrm{Cov}}
 \newcommand{\Corr}{\mathrm{Corr}}

%----------------------------------------------------------------------------------------
%	TITLE PAGE
%----------------------------------------------------------------------------------------

\title{
\vspace{2in}
\textmd{\textbf{\hmwkClass:\ \hmwkTitle}}\\
\normalsize\vspace{0.1in}\small{Due\ on\ \hmwkDueDate}\\
\vspace{3in}
}

\author{\textbf{\hmwkAuthorName}}
\date{} % Insert date here if you want it to appear below your name

%----------------------------------------------------------------------------------------

\begin{document}


\maketitle

%----------------------------------------------------------------------------------------
%	TABLE OF CONTENTS
%----------------------------------------------------------------------------------------

%\setcounter{tocdepth}{1} % Uncomment this line if you don't want subsections listed in the ToC

%%\newpage
%%\tableofcontents
\newpage

%----------------------------------------------------------------------------------------
%	PROBLEM 1
%----------------------------------------------------------------------------------------

% To have just one problem per page, simply put a \clearpage after each problem

\begin{homeworkProblem}
	Let $V$ and $S$ denote sum of values of options and stock price respectively, then we can denote portfolio of the market maker as $\Pi = V - \Delta S$. By Ito's lemma, the following equation follows.
%----------------------------------------------------------------------------------------
	%% ITO LEMMA
	\begin{equation*}
		d\Pi = \pdv{V}{t}dt + \pdv{V}{S}dS + \frac{1}{2} \pdv[2]{V}{S}dS^2 - \Delta dS
	\end{equation*}
%----------------------------------------------------------------------------------------
	Since the portfolio has zero delta, $d\Pi = \pdv{V}{t}dt  + \frac{1}{2} \pdv[2]{V}{S}dS^2 = \pdv{V}{t}dt + \frac{1}{2}S^2 \sigma^2 \pdv[2]{V}{S} dt$ holds. Since the portfolio became riskless, by no arbitrage principle, its return must be equal to risk-free rate as follows.
%----------------------------------------------------------------------------------------
	%% RISKLESS PORTFOLIO
	\begin{equation*}
		d\Pi = \pdv{V}{t}dt + \frac{1}{2}S^2 \sigma^2 \pdv[2]{V}{S} dt = r\Pi dt
	\end{equation*}
%----------------------------------------------------------------------------------------	
	Since parameters are given as $\pdv[2]{V}{S} = -1,725$, $S = 143$, $r = 0.05$, $\sigma = 0.7$, plugging them into the equation above, we can obtain the following result.
%----------------------------------------------------------------------------------------	
	%% THETA OF PORTFOLIO	
	\begin{equation*}
	\begin{aligned}
		& \pdv{V}{t} + \frac{1}{2} \times (143)^2 \times (0.7)^2 \times (-1725) = 0.05 \times 30,000,000	\\
		& \Rightarrow \pdv{V}{t} = 10,142,258.6
	\end{aligned}
	\end{equation*}
%----------------------------------------------------------------------------------------
	Assuming a year is equal to 365 days, if the stock price is unchanged, the expected value of the positions is approximately $\Pi + d\Pi = \Pi + \pdv{V}{t}dt = 30,000,000 + 10,142,258.6 \times \frac{1}{365} = 30,027,787.01$. The value might not be exact since the whole procedure was implemented on continuous time framework which is not exactly consistent to this problem. However, since $dt = \frac{1}{365}$ is small enough, errors can be ignored.
%----------------------------------------------------------------------------------------	
\end{homeworkProblem}

%----------------------------------------------------------------------------------------
%	PROBLEM 2
%----------------------------------------------------------------------------------------
\begin{homeworkProblem}
	Since it is assumed that Black-Scholes assumptions hold, put option price is calculated as follows.
	\begin{equation*}
	\begin{aligned}
		&p = B_{t, T}(KN(-d_2) - FN(-d_1))	\\
		&d_1 = \frac{\log({F / K}) + \frac{1}{2} \sigma^2 (T - t)}{\sigma \sqrt{T - t}}	\\
		&d_2 = d_1 - \sqrt{T - t}
		\end{aligned}
	\end{equation*}
	Let $p_1, p_2, p_3, p_4$ denote price of put options with time to maturity from 2 months to 5 months, respectively. Since all parameters need for valuing option are given except volatility, and it is assumed that all of options have same implied volatility, it is possible to calculate volatility by using the formula inversely. In other words, we can obtain implied volatility by searching $\sigma$ which equates sum of option prices to 2 millions. (find $\sigma$ such that $\sum_{i = 1}^4 p_i = 2,000,000$) By taking some numerical procedures, the implied volatility is calculated as about 9.63\%. Prices of each option are calculated as Table \ref{tab:prob2 - price of options}.
%----------------------------------------------------------------------------------------
	%% PRICE OF EACH OPTION
	\begin{table}[ht]
	\centering
	\begin{tabular}{@{}cc@{}}
	\toprule
	~~Maturity & Price~~   \\ \midrule
	~~2 months & 351,710~~ \\
	~~3 months & 464,836~~ \\
	~~4 months & 555,220~~ \\
	~~5 months & 628,235~~ \\ \bottomrule
	\end{tabular}
	\caption{Price of options}
	\label{tab:prob2 - price of options}
	\end{table}
%----------------------------------------------------------------------------------------
\end{homeworkProblem}
%----------------------------------------------------------------------------------------
%	PROBLEM 3
%----------------------------------------------------------------------------------------
\begin{homeworkProblem}
\begin{enumerate}[(a)]
	\item		%% problem (a)
	Under Black-Scholes economy, call option price is calculated as $c = e^{-r(T - t)}\E_t^Q[\max(S_T - K, 0)]$, where $\E_t^Q$ is an expectation operator under risk neutral measure conditioning at time $t$. Since we already know that $c = SN(d_1) - Ke^{-r(T - t)}N(d_2)$ and $p = Ke^{-r(T - t)}N(-d_2) - SN(-d_1)$, where $d_1 = \frac{\log(S / Ke^{-r(T - t)}) + \frac{1}{2} \sigma^2 (T - t)}{\sigma \sqrt{T - t}}$, $d_2 = d_1 - \sigma \sqrt{T - t}$, expected payoff under risk neutral measure can be derived as follows.
%----------------------------------------------------------------------------------------
	%% EXPECTED PAYOFF UNDER RISK NEUTRAL MEASURE
	\begin{equation*}
	\begin{aligned}
		\E_t^Q[\max(S_T - K, 0)] = Se^{r(T - t)}N(d_1) - KN(d_2)	\\
		\E_t^Q[\max(K - S_T, 0)] = KN(-d_2) - Se^{r(T - t)}N(-d_1)
	\end{aligned}
	\end{equation*}	
%----------------------------------------------------------------------------------------	
	Under risk neutral measure, expected return of physical measure $\mu$ is converted into risk free rate, $r$. Therefore, by converting all $r$ into $\mu$, we can obtain true expected payoff. Therefore, true expected payoff of options are derived as follows.
%----------------------------------------------------------------------------------------	
	%% TRUE EXPECTED PAYOFF
	\begin{equation*}
	\begin{aligned}
		&\E_t[\max(S_T - K, 0)] = Se^{\mu(T - t)}N(d_1) - KN(d_2)	\\
		&\E_t[\max(K - S_T, 0)] = KN(-d_2) - Se^{\mu(T - t)}N(-d_1)	\\
		&d_1 = \frac{\log(S / Ke^{-\mu(T - t)}) + \frac{1}{2} \sigma^2 (T - t)}{\sigma \sqrt{T - t}}	\\
		&d_2 = d_1 - \sqrt{T - t}
	\end{aligned}
	\end{equation*}
%----------------------------------------------------------------------------------------	
	By using the formula above, expected payoff of straddle is calculated as follows.
%----------------------------------------------------------------------------------------	
	%% EXPECTED PAYOFF TABLE
	\begin{table}[ht]
	\centering
	\label{my-label}
	\begin{tabular}{@{}cc@{}}
	\toprule
	~Volatility~                     & ~Expected Payoff~   \\ \midrule
	0.2 & 17.506	\\
	0.3 & 25.376	\\
	0.4 & 33.348	\\
	0.5 & 41.306	\\	\bottomrule
	\end{tabular}
	\caption{Expected payoff under physical measure}	\label{tab:prob3-(a): Expected payoff}
	\end{table}
%----------------------------------------------------------------------------------------	
	It is well-known that a straddle is more worth when volatility is larger. From the result, we can find expected payoff of straddle increases as volatility increases, so the result is consistent with that fact.
%----------------------------------------------------------------------------------------		
	\item		%% problem (b)
	By using the Algorithm \ref{alg: monte-carlo} mentioned below(See the last page), it is possible to implement dynamic replication strategy. Table \ref{tab:prob3-(b): Simulation Result} shows the result from simulation. Simulation was performed with 10,000 sample paths and 500 time steps.
%----------------------------------------------------------------------------------------	
	%% RESULT TABLE	
	\begin{table}[ht]
	\centering
	\label{my-label}
	\begin{tabular}{@{}ccccc@{}}
	\toprule
	Volatility                       & 0.2    & 0.3    & 0.4    & 0.5    \\ \midrule
	Payoff from analytic solution    & 17.506 & 25.376 & 33.348 & 41.306 \\
	Payoff from dynamic replication  & 1.457  & 1.242  & 1.691  & 1.860  \\
	Standard deviation of simulation & 0.146  & 0.226  & 0.306  & 0.407  \\ \bottomrule
	\end{tabular}
	\caption{Simulation result}	\label{tab:prob3-(b): Simulation Result}
	\end{table}
%----------------------------------------------------------------------------------------	
	\item		%% problem (c)
	As shown in Table \ref{tab:prob3-(b): Simulation Result}, there is a large difference between analytic payoff and value of replication strategy. It is because the replication strategy cannot reflect curvature of the straddle with respect to spot price. It just replicated straddle price with respect to ``direction'' of spot price: going up or down of price. However, value of straddle is actually independent to direction of spot price. What actually matters is the amount of change in price. Payoff of straddle gets larger when spot price at maturity is far from the strike price, so volatility is the key feature. Since delta of a straddle increases as spot price increases, the position requires more underlyings if spot price gets higher and vice versa. It means the position has ``buy-high, sell-low'' strategy. The loss from ``buy-high, sell-low'' is compensated through treating curvature of straddle such as including options in replicating portfolio. However, in this portfolio, there is no such securities, therefore it cannot replicate payoff of straddle. Of course, it is possible to think that this delta-hedged portfolio should have zero value at maturity. However, it is not because the expected return of spot price is not zero. Since delta-hedging portfolio is a portfolio replicating payoff of derivatives from ``directional'' changes of underlying asset price, the portfolio has positive value because a straddle has positive value if underlying asset price goes up. If expected return of spot price is zero, expected payoff of replicating portfolio would be zero. Table \ref{tab:prob3-(c) expected payoff with zero mu} shows expected payoff of replicating portfolio when $\mu = 0$. Simulation was performed with 10,000 sample paths and 500 time steps.%----------------------------------------------------------------------------------------	
	%% EXPECTED PAYOFF(ZERO MU)		
	\begin{table}[ht]
	\centering
	\begin{tabular}{@{}ccc@{}}
	\toprule
	Volatility & Expected Payoff & Standard Deviation \\ \midrule
	0.2        & -0.011          & 0.124              \\
	0.3        & 0.116           & 0.193              \\
	0.4        & -0.002          & 0.273              \\
	0.5        & 0.007           & 0.359              \\ \bottomrule
	\end{tabular}
	\caption{Expected payoff($\mu = 0$)} 	\label{tab:prob3-(c) expected payoff with zero mu}
	\end{table}
%----------------------------------------------------------------------------------------	
	Unlike results in Table \ref{tab:prob3-(b): Simulation Result}, expected payoffs are closed to zero, and all expected payoffs are within $0 \pm \sigma$ where $\sigma$ is standard deviation of simulation. It means that we cannot say expected payoffs are different to zero, statistically. Therefore, we can conclude that the replicating portfolio should not be zero unless expected return of spot price is not zero.
	\end{enumerate}
\end{homeworkProblem}
\begin{homeworkProblem}
	\begin{enumerate}[(a)]
	\item		%% problem (a)
	By using similar procedure with Algorithm \ref{alg: monte-carlo}, only changing $D_{j+1}$ as $b(S_{j+1} - S_0)$, the expected cash-flow and standard deviation can be obtained. Table \ref{tab:prob4-(a) expected cash flow} shows expected cash flow and standard deviation with respect to volatilities. Simulation was performed with 50,000 sample paths and 500 time steps.
%----------------------------------------------------------------------------------------	
	%% EXPECTED CASH FLOW
	\begin{table}[ht]
	\centering
	\begin{tabular}{@{}ccc@{}}
	\toprule
	Volatility & Expected Cash Flow & Standard Deviation \\ \midrule
	0.2        & 4.23               & 0.19               \\
	0.3        & 6.08               & 0.47               \\
	0.4        & 8.31               & 0.92               \\
	0.5        & 13.51              & 1.85               \\ \bottomrule
	\end{tabular}
	\caption{Expected cash flow of the strategy}	\label{tab:prob4-(a) expected cash flow}
	\end{table}
%----------------------------------------------------------------------------------------	
	From the table, the expected cash flow increases as volatility increases. However, we cannot say ``long volatility'' strategy because the positive return is caused by positive expected return, not volatility. Table \ref{tab:prob4-(a) expected cash flow with zero mu} shows the expected cash flow where expected return of spot price is zero.
%----------------------------------------------------------------------------------------	
	%% EXPECTED CASH FLOW ZERO MU
	\begin{table}[ht]
	\centering
	\begin{tabular}{@{}ccc@{}}
	\toprule
	Volatility & Expected Cash Flow & Standard Deviation \\ \midrule
	0.2        & 0.13               & 0.14               \\
	0.3        & -0.49               & 0.36               \\
	0.4        & 0.60               & 0.82               \\
	0.5        & 0.87              & 1.49               \\ \bottomrule
	\end{tabular}
	\caption{Expected cash flow of the strategy($\mu = 0$)}	\label{tab:prob4-(a) expected cash flow with zero mu}
	\end{table}
%----------------------------------------------------------------------------------------	
	From the table, although volatility is same as Table \ref{tab:prob4-(a) expected cash flow}, we can find that expected cash flow is quite low. There is even a negative expected cash flow. Almost all cash flows are statistically indifferent to zero. Therefore, we cannot conclude that the strategy is ``long volatility'' strategy. Instead, the strategy invests in positive expected return of spot price.
	\item		%% problem (b)
	By using similar simulation procedure, expected return and Sharpe ratio was calculated as Table \ref{tab:prob4-b - expected return and sharpe ratio}. Sharpe ratio was calculated as (Expected return / Standard deviation) since we assumed that risk free rate is equal to zero.
%----------------------------------------------------------------------------------------		
	\begin{table}[ht]
	\centering
	\begin{tabular}{@{}cccc@{}}
	\toprule
	Volatility & Expected Return & Standard Deviation & Sharpe Ratio \\ \midrule
	0.2        & 1.73\%          & 0.18             & 0.10        \\
	0.3        & 2.63\%          & 0.43             & 0.06        \\
	0.4        & 3.14\%          & 0.89             & 0.04         \\
	0.5        & 6.02\%          & 1.79             & 0.03         \\ \bottomrule
	\end{tabular}
	\caption{Expected return and Sharpe ratio} 	\label{tab:prob4-b - expected return and sharpe ratio}	
	\end{table}
	From the result, it can be find that expected return increases as volatility of spot price increase, however Sharpe ratio decreases since standard deviation increases more rapidly than expected return. Therefore, from the perspective of mean-variance, increase in volatility does not seem attractive since it increases risks more than expected return.
	\end{enumerate}
%----------------------------------------------------------------------------------------	
	\end{homeworkProblem}
%----------------------------------------------------------------------------------------	
\newpage
	%% ALGORITHM FOR HEDGE SIMULATION
	\begin{algorithm}[ht]
	\caption{Monte-Carlo Simulation for Dynamic Replication\label{alg: monte-carlo}} 
		\KwIn{$S_0$, $K$, $\mu$, $r$, $d$, $\sigma$, $T$, $N$, $M$} \tcp{$N$ and $M$ denote number of time steps and number of paths, respectively.}
		\KwOut{Average of payoff, Standard Deviation}
		Set P as an array	\tcp{P: array of portfolio value at maturity for each sample path}
		Set $\Delta t = T / N$	\\
		\For{$i \gets 1$ \textbf{to} M} {
			Initialize S, D, C as an array \tcp{S: stock price path, D: delta path, C: cash path}
			Set $S_1 = S_0$, $D_1 = N(d_1; S_1) - N(-d_1; S_1)$, $C_1 = -D_1S_1$.	\\
			\For{$j \gets 1$ \textbf{to} $N$} {
				Generate random number $Z$ which follows $N(0, 1)$.	\\
				Calculate $S_{j+1} = S_{j}e^{(\mu - d - \frac{1}{2}\sigma^2) \Delta t + \sigma \sqrt{\Delta t} Z}$	\\
				\If{$j \neq N$} {
					\tcp{Delta of straddle is equal to sum of deltas of call and put.}
					Calculate $D_{j+1} = N(d_1;S_{j+1}) - N(-d_1;S_{j+1})$ \\	
					\tcp{The rest of cash after rebalancing}
					Calculate $C_{j+1} = C_{j}e^{r \Delta t} - (D_{j+1} - D_{j})S_{j+1}$.
				}
				\Else{
					\tcp{$j = N$ case}
					Calculate $P_i = D_{N} S_{N+1} + C_{N}e^{r \Delta t}$.	\tcp{Value at maturity at $i^{th}$ path}
				}
			}
		}
		\Return{$\bar{P}$, $\sigma_P / \sqrt{M}$}	\tcp{$\bar{P}$: average of $P$, $\sigma_P$: standard deviation of $P$.}
	\end{algorithm}
\end{document}
